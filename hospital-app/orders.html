<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pedidos - Hospital Santa Joana</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .orders-tabs {
            display: flex;
            background-color: white;
            padding: var(--spacing-md);
            border-bottom: 1px solid var(--border);
            gap: var(--spacing-md);
        }
        
        .orders-tab {
            padding: var(--spacing-sm) var(--spacing-md);
            border-radius: var(--radius-full);
            font-size: var(--font-caption);
            font-weight: 500;
            background-color: var(--background);
            border: none;
            color: var(--text-secondary);
        }
        
        .orders-tab.active {
            background-color: var(--primary-blue);
            color: white;
        }
        
        .order-list {
            padding-top: var(--spacing-md);
        }
        
        .order-list .order-card {
            cursor: pointer;
        }
        
        .empty-orders {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px 0;
            text-align: center;
        }
        
        .empty-orders i {
            font-size: 64px;
            color: var(--border);
            margin-bottom: 16px;
        }
        
        .empty-orders h3 {
            font-size: 20px;
            margin-bottom: 8px;
        }
        
        .empty-orders p {
            color: var(--text-secondary);
            margin-bottom: 24px;
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="screen active" id="orders-screen">
            <header class="app-header">
                <div class="header-left">
                    <button class="back-button" onclick="window.location.href='dashboard.html'">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                    <h2>Meus Pedidos</h2>
                </div>
            </header>

            <div class="orders-tabs">
                <button class="orders-tab active" data-status="all">Todos</button>
                <button class="orders-tab" data-status="pending">Pendentes</button>
                <button class="orders-tab" data-status="in-progress">Em preparo</button>
                <button class="orders-tab" data-status="delivered">Entregues</button>
            </div>

            <div class="content-area">
                <div id="orders-container" class="order-list">
                    <!-- Orders will be loaded dynamically by JavaScript -->
                </div>
                
                <div id="empty-orders-message" style="display: none;" class="empty-orders">
                    <i class="fas fa-clipboard-list"></i>
                    <h3>Nenhum pedido encontrado</h3>
                    <p>Você ainda não possui pedidos nesta categoria</p>
                    <button class="btn-primary" onclick="window.location.href='menu.html'">Fazer um Pedido</button>
                </div>
            </div>

            <nav class="bottom-nav">
                <a href="dashboard.html" class="nav-item">
                    <i class="fas fa-home"></i>
                    <span>Início</span>
                </a>
                <a href="menu.html" class="nav-item">
                    <i class="fas fa-utensils"></i>
                    <span>Cardápio</span>
                </a>
                <a href="cart.html" class="nav-item">
                    <i class="fas fa-shopping-cart"></i>
                    <span>Carrinho</span>
                    <span class="badge cart-badge">0</span>
                </a>
                <a href="orders.html" class="nav-item active">
                    <i class="fas fa-clipboard-list"></i>
                    <span>Pedidos</span>
                </a>
                <a href="invoice.html" class="nav-item">
                    <i class="fas fa-file-invoice-dollar"></i>
                    <span>Fatura</span>
                </a>
            </nav>
        </div>
    </div>

    <script src="js/app.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Sample orders if none exist
            if (!localStorage.getItem('orders')) {
                const sampleOrders = [
                    {
                        id: 1,
                        date: new Date(Date.now() - 2 * 60 * 60 * 1000), // 2 hours ago
                        items: [
                            { id: 1, name: 'Café da manhã', price: 18.90, quantity: 1 },
                            { id: 10, name: 'Água Mineral', price: 3.50, quantity: 2 }
                        ],
                        notes: "",
                        subtotal: 25.90,
                        serviceFee: 2.59,
                        total: 28.49,
                        status: 'delivered'
                    },
                    {
                        id: 2,
                        date: new Date(Date.now() - 24 * 60 * 60 * 1000), // 1 day ago
                        items: [
                            { id: 6, name: 'Jantar Leve', price: 18.90, quantity: 1 },
                            { id: 11, name: 'Suco Natural', price: 7.90, quantity: 1 },
                            { id: 8, name: 'Pudim de Leite', price: 8.50, quantity: 1 }
                        ],
                        notes: "Sem sal no jantar, por favor.",
                        subtotal: 35.30,
                        serviceFee: 3.53,
                        total: 38.83,
                        status: 'delivered'
                    },
                    {
                        id: 3,
                        date: new Date(), // Now
                        items: [
                            { id: 4, name: 'Almoço Executivo', price: 27.90, quantity: 1 },
                            { id: 10, name: 'Água Mineral', price: 3.50, quantity: 1 }
                        ],
                        notes: "Sem pimenta, por favor.",
                        subtotal: 31.40,
                        serviceFee: 3.14,
                        total: 34.54,
                        status: 'pending'
                    }
                ];
                
                localStorage.setItem('orders', JSON.stringify(sampleOrders));
            }
            
            // Get cart count from localStorage
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            updateCartBadge(cart.reduce((total, item) => total + item.quantity, 0));
            
            // Display all orders initially
            displayOrders('all');
            
            // Tab click event listeners
            document.querySelectorAll('.orders-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const status = this.getAttribute('data-status');
                    
                    // Update active tab
                    document.querySelectorAll('.orders-tab').forEach(t => {
                        t.classList.remove('active');
                    });
                    this.classList.add('active');
                    
                    // Display filtered orders
                    displayOrders(status);
                });
            });
            
            function displayOrders(status) {
                const orders = JSON.parse(localStorage.getItem('orders')) || [];
                const container = document.getElementById('orders-container');
                const emptyMessage = document.getElementById('empty-orders-message');
                
                let filteredOrders;
                
                if (status === 'all') {
                    filteredOrders = orders;
                } else {
                    filteredOrders = orders.filter(order => order.status === status);
                }
                
                if (filteredOrders.length === 0) {
                    container.innerHTML = '';
                    emptyMessage.style.display = 'flex';
                } else {
                    emptyMessage.style.display = 'none';
                    renderOrders(filteredOrders);
                }
            }
            
            function renderOrders(orders) {
                const container = document.getElementById('orders-container');
                container.innerHTML = '';
                
                // Sort orders by date, newest first
                orders.sort((a, b) => new Date(b.date) - new Date(a.date));
                
                orders.forEach(order => {
                    const mainItems = order.items.slice(0, 2);
                    const additionalCount = order.items.length - 2;
                    
                    const orderCard = document.createElement('div');
                    orderCard.className = 'order-card';
                    orderCard.setAttribute('data-id', order.id);
                    
                    // Format the status display
                    let statusClass = '';
                    let statusText = '';
                    
                    switch(order.status) {
                        case 'pending':
                            statusClass = 'pending';
                            statusText = 'Pendente';
                            break;
                        case 'in-progress':
                            statusClass = 'in-progress';
                            statusText = 'Em preparo';
                            break;
                        case 'delivered':
                            statusClass = 'delivered';
                            statusText = 'Entregue';
                            break;
                    }
                    
                    orderCard.innerHTML = `
                        <div class="order-info">
                            <p class="order-date">${formatDate(new Date(order.date))}</p>
                            <p class="order-items">
                                ${mainItems.map(item => item.name).join(', ')}
                                ${additionalCount > 0 ? ` e mais ${additionalCount} item(s)` : ''}
                            </p>
                            <p class="order-price">R$ ${formatCurrency(order.total)}</p>
                        </div>
                        <div class="order-status">
                            <span class="status-pill ${statusClass}">${statusText}</span>
                        </div>
                    `;
                    
                    container.appendChild(orderCard);
                    
                    // Add click event to view order details
                    orderCard.addEventListener('click', function() {
                        window.location.href = `order-details.html?id=${order.id}`;
                    });
                });
            }
            
            function formatDate(date) {
                const now = new Date();
                const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                const yesterday = new Date(today);
                yesterday.setDate(yesterday.getDate() - 1);
                
                if (date.getDate() === today.getDate() && 
                    date.getMonth() === today.getMonth() && 
                    date.getFullYear() === today.getFullYear()) {
                    return `Hoje, ${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}`;
                } else if (date.getDate() === yesterday.getDate() && 
                           date.getMonth() === yesterday.getMonth() && 
                           date.getFullYear() === yesterday.getFullYear()) {
                    return `Ontem, ${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}`;
                } else {
                    return `${date.getDate().toString().padStart(2, '0')}/${(date.getMonth() + 1).toString().padStart(2, '0')}/${date.getFullYear()}, ${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}`;
                }
            }
            
            function formatCurrency(value) {
                return value.toFixed(2).replace('.', ',');
            }
            
            function updateCartBadge(count) {
                const badges = document.querySelectorAll('.cart-badge');
                
                badges.forEach(badge => {
                    badge.textContent = count;
                    badge.style.display = count > 0 ? 'flex' : 'none';
                });
            }
        });
    </script>
</body>
</html>
