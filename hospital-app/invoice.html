<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fatura - Hospital Santa Joana</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .invoice-header {
            background-color: white;
            border-radius: var(--radius-lg);
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-md);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        
        .invoice-title {
            font-size: var(--font-h2);
            font-weight: 700;
            margin-bottom: var(--spacing-sm);
        }
        
        .invoice-date {
            font-size: var(--font-caption);
            color: var(--text-secondary);
        }
        
        .invoice-summary {
            background-color: white;
            border-radius: var(--radius-lg);
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-md);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        
        .invoice-card-title {
            font-size: var(--font-h2);
            font-weight: 700;
            margin-bottom: var(--spacing-md);
        }
        
        .invoice-patient-info {
            margin-bottom: var(--spacing-md);
        }
        
        .patient-info-row {
            display: flex;
            margin-bottom: var(--spacing-xs);
        }
        
        .patient-info-label {
            width: 120px;
            color: var(--text-secondary);
        }
        
        .patient-info-value {
            font-weight: 500;
        }
        
        .invoice-total-card {
            background-color: var(--primary-blue);
            color: white;
            border-radius: var(--radius-lg);
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-md);
        }
        
        .invoice-total-label {
            font-size: var(--font-body);
            margin-bottom: var(--spacing-xs);
        }
        
        .invoice-total-value {
            font-size: 32px;
            font-weight: 700;
        }
        
        .invoice-status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: var(--radius-full);
            font-size: 14px;
            font-weight: 500;
            margin-top: var(--spacing-sm);
        }
        
        .invoice-status.pending {
            background-color: rgba(255, 255, 255, 0.2);
        }
        
        .invoice-status.paid {
            background-color: rgba(16, 185, 129, 0.2);
        }
        
        .invoice-items-section {
            background-color: white;
            border-radius: var(--radius-lg);
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-md);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        
        .invoice-day-group {
            margin-bottom: var(--spacing-lg);
        }
        
        .invoice-day-group:last-child {
            margin-bottom: 0;
        }
        
        .invoice-day-header {
            font-weight: 700;
            font-size: var(--font-body);
            margin-bottom: var(--spacing-sm);
            padding-bottom: var(--spacing-sm);
            border-bottom: 1px solid var(--border);
        }
        
        .invoice-item {
            display: flex;
            justify-content: space-between;
            padding: var(--spacing-sm) 0;
            border-bottom: 1px solid var(--border);
        }
        
        .invoice-item:last-child {
            border-bottom: none;
        }
        
        .invoice-item-name {
            flex: 1;
        }
        
        .invoice-item-quantity {
            color: var(--text-secondary);
            margin-right: var(--spacing-md);
        }
        
        .invoice-item-price {
            font-weight: 500;
            min-width: 80px;
            text-align: right;
        }
        
        .invoice-day-total {
            display: flex;
            justify-content: space-between;
            font-weight: 700;
            padding-top: var(--spacing-sm);
            margin-top: var(--spacing-sm);
            border-top: 1px solid var(--border);
        }
        
        .invoice-payment-info {
            background-color: white;
            border-radius: var(--radius-lg);
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-xl);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        
        .invoice-payment-note {
            color: var(--text-secondary);
            font-style: italic;
            margin-top: var(--spacing-md);
        }
        
        .action-buttons {
            display: flex;
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-xl);
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="screen active" id="invoice-screen">
            <header class="app-header">
                <div class="header-left">
                    <button class="back-button" onclick="window.location.href='dashboard.html'">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                    <h2>Minha Fatura</h2>
                </div>
                <div class="header-actions">
                    <button class="icon-button" id="download-invoice-btn">
                        <i class="fas fa-download"></i>
                    </button>
                </div>
            </header>

            <div class="content-area">
                <div class="invoice-header">
                    <h3 class="invoice-title">Fatura Hospital Santa Joana</h3>
                    <p class="invoice-date">Atualizada em: <span id="invoice-date">24/05/2023, 12:30</span></p>
                </div>
                
                <div class="invoice-total-card">
                    <p class="invoice-total-label">Valor Total</p>
                    <p class="invoice-total-value">R$ <span id="invoice-total-value">320,50</span></p>
                    <span class="invoice-status pending" id="invoice-status">Pendente</span>
                </div>
                
                <div class="invoice-summary">
                    <h3 class="invoice-card-title">Informações do Paciente</h3>
                    <div class="invoice-patient-info">
                        <div class="patient-info-row">
                            <span class="patient-info-label">Nome:</span>
                            <span class="patient-info-value" id="patient-name">Maria Silva</span>
                        </div>
                        <div class="patient-info-row">
                            <span class="patient-info-label">Quarto:</span>
                            <span class="patient-info-value" id="patient-room">302</span>
                        </div>
                        <div class="patient-info-row">
                            <span class="patient-info-label">Data de entrada:</span>
                            <span class="patient-info-value" id="patient-admission-date">22/05/2023</span>
                        </div>
                    </div>
                </div>
                
                <div class="invoice-items-section">
                    <h3 class="invoice-card-title">Detalhes dos Consumos</h3>
                    <div id="invoice-items-container">
                        <!-- Invoice items will be loaded dynamically -->
                    </div>
                </div>
                
                <div class="invoice-payment-info">
                    <h3 class="invoice-card-title">Informações de Pagamento</h3>
                    <div class="patient-info-row">
                        <span class="patient-info-label">Status:</span>
                        <span class="patient-info-value">Pendente - A ser pago na alta hospitalar</span>
                    </div>
                    <div class="patient-info-row">
                        <span class="patient-info-label">Métodos:</span>
                        <span class="patient-info-value">Cartão de crédito, débito, dinheiro ou PIX</span>
                    </div>
                    <p class="invoice-payment-note">
                        Todos os valores consumidos durante sua estadia serão consolidados em uma única fatura a ser paga no momento da alta hospitalar. Para mais informações, contate a recepção.
                    </p>
                </div>
                
                <div class="action-buttons">
                    <button class="btn-secondary" id="download-pdf-btn">
                        <i class="fas fa-file-pdf"></i> Baixar PDF
                    </button>
                    <button class="btn-primary" id="help-btn">
                        <i class="fas fa-question-circle"></i> Ajuda com Fatura
                    </button>
                </div>
            </div>

            <nav class="bottom-nav">
                <a href="dashboard.html" class="nav-item">
                    <i class="fas fa-home"></i>
                    <span>Início</span>
                </a>
                <a href="menu.html" class="nav-item">
                    <i class="fas fa-utensils"></i>
                    <span>Cardápio</span>
                </a>
                <a href="cart.html" class="nav-item">
                    <i class="fas fa-shopping-cart"></i>
                    <span>Carrinho</span>
                    <span class="badge cart-badge">0</span>
                </a>
                <a href="orders.html" class="nav-item">
                    <i class="fas fa-clipboard-list"></i>
                    <span>Pedidos</span>
                </a>
                <a href="invoice.html" class="nav-item active">
                    <i class="fas fa-file-invoice-dollar"></i>
                    <span>Fatura</span>
                </a>
            </nav>
        </div>
    </div>

    <script src="js/app.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Sample invoice data if none exists
            const invoiceData = {
                total: 320.50,
                status: 'pending',
                date: new Date(),
                items: [
                    {
                        date: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000), // 2 days ago
                        items: [
                            { name: 'Café da manhã', quantity: 1, price: 18.90 },
                            { name: 'Almoço', quantity: 1, price: 32.90 },
                            { name: 'Jantar', quantity: 1, price: 28.50 },
                            { name: 'Água Mineral', quantity: 3, price: 3.50 }
                        ]
                    },
                    {
                        date: new Date(Date.now() - 1 * 24 * 60 * 60 * 1000), // 1 day ago
                        items: [
                            { name: 'Café da manhã', quantity: 1, price: 18.90 },
                            { name: 'Almoço', quantity: 1, price: 32.90 },
                            { name: 'Jantar', quantity: 1, price: 28.50 },
                            { name: 'Suco Natural', quantity: 2, price: 7.90 },
                            { name: 'Kit Higiene', quantity: 1, price: 18.50 }
                        ]
                    },
                    {
                        date: new Date(), // Today
                        items: [
                            { name: 'Café da manhã', quantity: 1, price: 18.90 },
                            { name: 'Almoço', quantity: 1, price: 32.90 },
                            { name: 'Água Mineral', quantity: 2, price: 3.50 }
                        ]
                    }
                ]
            };
            
            // Update user info from localStorage
            const user = JSON.parse(localStorage.getItem('user')) || { name: 'Maria Silva', room: '302' };
            document.getElementById('patient-name').textContent = user.name;
            document.getElementById('patient-room').textContent = user.room;
            
            // Get cart count from localStorage
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            updateCartBadge(cart.reduce((total, item) => total + item.quantity, 0));
            
            // Update invoice details
            document.getElementById('invoice-date').textContent = formatDate(invoiceData.date);
            document.getElementById('invoice-total-value').textContent = formatCurrency(invoiceData.total);
            document.getElementById('patient-admission-date').textContent = formatDate(new Date(Date.now() - 3 * 24 * 60 * 60 * 1000)); // 3 days ago
            
            // Generate invoice items
            renderInvoiceItems(invoiceData.items);
            
            // Add event listeners
            document.getElementById('download-invoice-btn').addEventListener('click', function() {
                showToast('Preparando download da fatura...', 'info');
                setTimeout(() => {
                    showToast('Fatura enviada para seu email', 'success');
                }, 2000);
            });
            
            document.getElementById('download-pdf-btn').addEventListener('click', function() {
                showToast('Gerando PDF da fatura...', 'info');
                setTimeout(() => {
                    showToast('PDF enviado para seu email', 'success');
                }, 2000);
            });
            
            document.getElementById('help-btn').addEventListener('click', function() {
                showToast('Conectando ao suporte...', 'info');
                setTimeout(() => {
                    alert('Para qualquer dúvida sobre sua fatura, por favor entre em contato com a equipe de atendimento ao cliente do Hospital Santa Joana pelo telefone (81) 3216-5555.');
                }, 1000);
            });
            
            function renderInvoiceItems(days) {
                const container = document.getElementById('invoice-items-container');
                container.innerHTML = '';
                
                days.forEach(day => {
                    const dayTotal = day.items.reduce((total, item) => total + (item.price * item.quantity), 0);
                    
                    const dayGroup = document.createElement('div');
                    dayGroup.className = 'invoice-day-group';
                    
                    const dayHeader = document.createElement('div');
                    dayHeader.className = 'invoice-day-header';
                    dayHeader.textContent = formatDate(new Date(day.date));
                    
                    dayGroup.appendChild(dayHeader);
                    
                    // Add each item
                    day.items.forEach(item => {
                        const invoiceItem = document.createElement('div');
                        invoiceItem.className = 'invoice-item';
                        invoiceItem.innerHTML = `
                            <span class="invoice-item-name">${item.name}</span>
                            <span class="invoice-item-quantity">x${item.quantity}</span>
                            <span class="invoice-item-price">R$ ${formatCurrency(item.price * item.quantity)}</span>
                        `;
                        
                        dayGroup.appendChild(invoiceItem);
                    });
                    
                    // Add day total
                    const dayTotalElement = document.createElement('div');
                    dayTotalElement.className = 'invoice-day-total';
                    dayTotalElement.innerHTML = `
                        <span>Total do dia</span>
                        <span>R$ ${formatCurrency(dayTotal)}</span>
                    `;
                    
                    dayGroup.appendChild(dayTotalElement);
                    container.appendChild(dayGroup);
                });
            }
            
            function formatDate(date) {
                const options = { day: '2-digit', month: '2-digit', year: 'numeric' };
                return new Date(date).toLocaleDateString('pt-BR', options);
            }
            
            function formatCurrency(value) {
                return value.toFixed(2).replace('.', ',');
            }
            
            function updateCartBadge(count) {
                const badges = document.querySelectorAll('.cart-badge');
                
                badges.forEach(badge => {
                    badge.textContent = count;
                    badge.style.display = count > 0 ? 'flex' : 'none';
                });
            }
            
            function showToast(message, type = 'default', duration = 3000) {
                // Remove any existing toasts
                const existingToast = document.querySelector('.toast');
                if (existingToast) {
                    existingToast.remove();
                }
                
                // Create new toast
                const toast = document.createElement('div');
                toast.className = `toast ${type}`;
                toast.textContent = message;
                
                document.body.appendChild(toast);
                
                // Show the toast
                setTimeout(() => {
                    toast.classList.add('show');
                }, 10);
                
                // Hide and remove the toast after duration
                setTimeout(() => {
                    toast.classList.remove('show');
                    setTimeout(() => {
                        toast.remove();
                    }, 300);
                }, duration);
            }
        });
    </script>
</body>
</html>
