<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detalhes do Pedido - Hospital Santa Joana</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .order-header {
            background-color: white;
            border-radius: var(--radius-lg);
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-md);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        
        .order-number {
            font-size: var(--font-h2);
            font-weight: 700;
            margin-bottom: var(--spacing-xs);
        }
        
        .order-date {
            font-size: var(--font-caption);
            color: var(--text-secondary);
            margin-bottom: var(--spacing-md);
        }
        
        .order-status-large {
            display: inline-block;
            padding: 8px 16px;
            border-radius: var(--radius-full);
            font-size: 14px;
            font-weight: 500;
        }
        
        .order-items-list {
            background-color: white;
            border-radius: var(--radius-lg);
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-md);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        
        .order-section-title {
            font-size: var(--font-h2);
            font-weight: 700;
            margin-bottom: var(--spacing-md);
        }
        
        .order-item {
            display: flex;
            align-items: center;
            margin-bottom: var(--spacing-md);
            padding-bottom: var(--spacing-md);
            border-bottom: 1px solid var(--border);
        }
        
        .order-item:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }
        
        .order-item-image {
            width: 50px;
            height: 50px;
            border-radius: var(--radius-md);
            overflow: hidden;
            margin-right: var(--spacing-md);
        }
        
        .order-item-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .order-item-details {
            flex: 1;
        }
        
        .order-item-name {
            font-weight: 600;
            margin-bottom: 2px;
        }
        
        .order-item-quantity {
            font-size: var(--font-caption);
            color: var(--text-secondary);
        }
        
        .order-item-price {
            font-weight: 600;
        }
        
        .order-notes-section {
            background-color: white;
            border-radius: var(--radius-lg);
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-md);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        
        .order-notes {
            font-size: var(--font-body);
            color: var(--text-secondary);
            font-style: italic;
        }
        
        .order-total-section {
            background-color: white;
            border-radius: var(--radius-lg);
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-md);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        
        .order-total-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        
        .order-total-row.final {
            font-weight: 700;
            font-size: 18px;
            border-top: 1px solid var(--border);
            padding-top: 12px;
            margin-top: 12px;
        }
        
        .order-actions {
            display: flex;
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-xl);
        }
        
        .tracking-status {
            background-color: white;
            border-radius: var(--radius-lg);
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-md);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        
        .tracking-timeline {
            position: relative;
            padding-left: 30px;
        }
        
        .timeline-item {
            position: relative;
            padding-bottom: var(--spacing-lg);
        }
        
        .timeline-item:last-child {
            padding-bottom: 0;
        }
        
        .timeline-item::before {
            content: "";
            position: absolute;
            left: -20px;
            top: 6px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: var(--border);
        }
        
        .timeline-item::after {
            content: "";
            position: absolute;
            left: -14px;
            top: 18px;
            width: 1px;
            height: calc(100% - 18px);
            background-color: var(--border);
        }
        
        .timeline-item:last-child::after {
            display: none;
        }
        
        .timeline-item.completed::before {
            background-color: var(--success);
        }
        
        .timeline-item.active::before {
            background-color: var(--secondary-blue);
        }
        
        .timeline-time {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 2px;
        }
        
        .timeline-status {
            font-weight: 600;
            margin-bottom: 2px;
        }
        
        .timeline-description {
            font-size: var(--font-caption);
            color: var(--text-secondary);
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="screen active" id="order-details-screen">
            <header class="app-header">
                <div class="header-left">
                    <button class="back-button" onclick="window.location.href='orders.html'">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                    <h2>Detalhes do Pedido</h2>
                </div>
            </header>

            <div class="content-area">
                <div class="order-header">
                    <h3 class="order-number">Pedido #<span id="order-id">1001</span></h3>
                    <p class="order-date" id="order-date">12/10/2023, 10:30</p>
                    <span class="order-status-large pending" id="order-status">Pendente</span>
                </div>
                
                <div class="tracking-status">
                    <h3 class="order-section-title">Status do Pedido</h3>
                    <div class="tracking-timeline" id="order-timeline">
                        <!-- Timeline items will be loaded dynamically -->
                    </div>
                </div>
                
                <div class="order-items-list">
                    <h3 class="order-section-title">Itens do Pedido</h3>
                    <div id="order-items-container">
                        <!-- Order items will be loaded dynamically -->
                    </div>
                </div>
                
                <div id="order-notes-container" class="order-notes-section">
                    <h3 class="order-section-title">Observações</h3>
                    <p class="order-notes" id="order-notes">Sem observações</p>
                </div>
                
                <div class="order-total-section">
                    <h3 class="order-section-title">Resumo</h3>
                    <div class="order-total-row">
                        <span>Subtotal</span>
                        <span id="order-subtotal">R$ 0,00</span>
                    </div>
                    <div class="order-total-row">
                        <span>Taxa de serviço</span>
                        <span id="order-service-fee">R$ 0,00</span>
                    </div>
                    <div class="order-total-row final">
                        <span>Total</span>
                        <span id="order-total">R$ 0,00</span>
                    </div>
                </div>
                
                <div class="order-actions">
                    <button class="btn-secondary" id="contact-support-btn">
                        <i class="fas fa-headset"></i> Suporte
                    </button>
                    <button class="btn-primary" id="reorder-btn">
                        <i class="fas fa-redo"></i> Repetir Pedido
                    </button>
                </div>
            </div>

            <nav class="bottom-nav">
                <a href="dashboard.html" class="nav-item">
                    <i class="fas fa-home"></i>
                    <span>Início</span>
                </a>
                <a href="menu.html" class="nav-item">
                    <i class="fas fa-utensils"></i>
                    <span>Cardápio</span>
                </a>
                <a href="cart.html" class="nav-item">
                    <i class="fas fa-shopping-cart"></i>
                    <span>Carrinho</span>
                    <span class="badge cart-badge">0</span>
                </a>
                <a href="orders.html" class="nav-item active">
                    <i class="fas fa-clipboard-list"></i>
                    <span>Pedidos</span>
                </a>
                <a href="invoice.html" class="nav-item">
                    <i class="fas fa-file-invoice-dollar"></i>
                    <span>Fatura</span>
                </a>
            </nav>
        </div>
    </div>

    <script src="js/app.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Get order ID from URL
            const urlParams = new URLSearchParams(window.location.search);
            const orderId = parseInt(urlParams.get('id'));
            
            if (!orderId) {
                // No order ID provided, redirect to orders page
                window.location.href = 'orders.html';
                return;
            }
            
            // Get cart count from localStorage
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            updateCartBadge(cart.reduce((total, item) => total + item.quantity, 0));
            
            // Get order from localStorage
            const orders = JSON.parse(localStorage.getItem('orders')) || [];
            const order = orders.find(o => o.id === orderId);
            
            if (!order) {
                // Order not found, redirect to orders page
                window.location.href = 'orders.html';
                return;
            }
            
            // Update order details in the UI
            document.getElementById('order-id').textContent = order.id;
            document.getElementById('order-date').textContent = formatDate(new Date(order.date));
            
            // Update status
            const statusElement = document.getElementById('order-status');
            statusElement.className = `order-status-large ${order.status}`;
            statusElement.textContent = getStatusText(order.status);
            
            // Render timeline
            renderTimeline(order);
            
            // Render order items
            renderOrderItems(order.items);
            
            // Update order notes
            const orderNotes = document.getElementById('order-notes');
            if (order.notes && order.notes.trim().length > 0) {
                orderNotes.textContent = order.notes;
            } else {
                orderNotes.textContent = 'Sem observações';
            }
            
            // Update totals
            document.getElementById('order-subtotal').textContent = `R$ ${formatCurrency(order.subtotal)}`;
            document.getElementById('order-service-fee').textContent = `R$ ${formatCurrency(order.serviceFee)}`;
            document.getElementById('order-total').textContent = `R$ ${formatCurrency(order.total)}`;
            
            // Add event listeners
            document.getElementById('contact-support-btn').addEventListener('click', function() {
                showToast('Entrando em contato com o suporte...', 'info');
                // In a real app, this would open a chat or call support
            });
            
            document.getElementById('reorder-btn').addEventListener('click', function() {
                // Add the items from this order to the cart
                const newCart = [...order.items];
                localStorage.setItem('cart', JSON.stringify(newCart));
                
                // Redirect to cart
                window.location.href = 'cart.html';
            });
            
            function renderTimeline(order) {
                const timelineContainer = document.getElementById('order-timeline');
                timelineContainer.innerHTML = '';
                
                // Define timeline steps based on order status
                const timeline = [];
                
                // Always add the "Order Placed" step as completed
                timeline.push({
                    time: formatDate(new Date(order.date)),
                    status: 'Pedido Recebido',
                    description: 'Seu pedido foi recebido pelo hospital',
                    state: 'completed'
                });
                
                // Add "Order In Preparation" step
                if (order.status === 'in-progress' || order.status === 'delivered') {
                    // This step is completed
                    timeline.push({
                        time: formatRelativeTime(new Date(order.date), 10), // Assume 10 minutes after order placed
                        status: 'Em Preparo',
                        description: 'Seu pedido está sendo preparado',
                        state: 'completed'
                    });
                } else if (order.status === 'pending') {
                    // This step is next
                    timeline.push({
                        time: 'Em breve',
                        status: 'Em Preparo',
                        description: 'Seu pedido será preparado em breve',
                        state: 'next'
                    });
                }
                
                // Add "Order Delivered" step
                if (order.status === 'delivered') {
                    // This step is completed
                    timeline.push({
                        time: formatRelativeTime(new Date(order.date), 30), // Assume 30 minutes after order placed
                        status: 'Entregue',
                        description: 'Seu pedido foi entregue com sucesso',
                        state: 'completed'
                    });
                } else {
                    // This step is future
                    timeline.push({
                        time: 'Em breve',
                        status: 'Entregue',
                        description: 'Seu pedido será entregue em breve',
                        state: 'future'
                    });
                }
                
                // Render the timeline
                timeline.forEach((step, index) => {
                    const timelineItem = document.createElement('div');
                    timelineItem.className = `timeline-item ${step.state}`;
                    
                    if (step.state === 'next') {
                        timelineItem.classList.add('active');
                    }
                    
                    timelineItem.innerHTML = `
                        <p class="timeline-time">${step.time}</p>
                        <p class="timeline-status">${step.status}</p>
                        <p class="timeline-description">${step.description}</p>
                    `;
                    
                    timelineContainer.appendChild(timelineItem);
                });
            }
            
            function renderOrderItems(items) {
                const container = document.getElementById('order-items-container');
                container.innerHTML = '';
                
                items.forEach(item => {
                    const orderItem = document.createElement('div');
                    orderItem.className = 'order-item';
                    orderItem.innerHTML = `
                        <div class="order-item-image">
                            <img src="${item.image || 'img/products/placeholder.jpg'}" alt="${item.name}">
                        </div>
                        <div class="order-item-details">
                            <p class="order-item-name">${item.name}</p>
                            <p class="order-item-quantity">Quantidade: ${item.quantity}</p>
                        </div>
                        <p class="order-item-price">R$ ${formatCurrency(item.price * item.quantity)}</p>
                    `;
                    
                    container.appendChild(orderItem);
                });
            }
            
            function getStatusText(status) {
                switch (status) {
                    case 'pending':
                        return 'Pendente';
                    case 'in-progress':
                        return 'Em Preparo';
                    case 'delivered':
                        return 'Entregue';
                    default:
                        return status;
                }
            }
            
            function formatDate(date) {
                const now = new Date();
                const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                const yesterday = new Date(today);
                yesterday.setDate(yesterday.getDate() - 1);
                
                if (date.getDate() === today.getDate() && 
                    date.getMonth() === today.getMonth() && 
                    date.getFullYear() === today.getFullYear()) {
                    return `Hoje, ${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}`;
                } else if (date.getDate() === yesterday.getDate() && 
                           date.getMonth() === yesterday.getMonth() && 
                           date.getFullYear() === yesterday.getFullYear()) {
                    return `Ontem, ${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}`;
                } else {
                    return `${date.getDate().toString().padStart(2, '0')}/${(date.getMonth() + 1).toString().padStart(2, '0')}/${date.getFullYear()}, ${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}`;
                }
            }
            
            function formatRelativeTime(baseDate, minutesLater) {
                const newDate = new Date(baseDate);
                newDate.setMinutes(newDate.getMinutes() + minutesLater);
                return `${newDate.getHours().toString().padStart(2, '0')}:${newDate.getMinutes().toString().padStart(2, '0')}`;
            }
            
            function formatCurrency(value) {
                return value.toFixed(2).replace('.', ',');
            }
            
            function updateCartBadge(count) {
                const badges = document.querySelectorAll('.cart-badge');
                
                badges.forEach(badge => {
                    badge.textContent = count;
                    badge.style.display = count > 0 ? 'flex' : 'none';
                });
            }
            
            function showToast(message, type = 'default', duration = 3000) {
                // Remove any existing toasts
                const existingToast = document.querySelector('.toast');
                if (existingToast) {
                    existingToast.remove();
                }
                
                // Create new toast
                const toast = document.createElement('div');
                toast.className = `toast ${type}`;
                toast.textContent = message;
                
                document.body.appendChild(toast);
                
                // Show the toast
                setTimeout(() => {
                    toast.classList.add('show');
                }, 10);
                
                // Hide and remove the toast after duration
                setTimeout(() => {
                    toast.classList.remove('show');
                    setTimeout(() => {
                        toast.remove();
                    }, 300);
                }, duration);
            }
        });
    </script>
</body>
</html>
